---
// This component loads GSAP lazily and makes it available globally
---

<script>
	// Lazy load GSAP only when needed
	let gsapLoaded = false;
	
	async function loadGSAP() {
		if (gsapLoaded || (typeof window !== 'undefined' && window.gsap)) {
			return Promise.resolve();
		}
		
		gsapLoaded = true;
		
		// Dynamic import - only loads when called
		const { gsap } = await import('gsap');
		const { ScrollTrigger } = await import('gsap/ScrollTrigger');
		const { ScrollToPlugin } = await import('gsap/ScrollToPlugin');
		
		gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);
		
		if (typeof window !== 'undefined') {
			window.gsap = gsap;
			window.ScrollTrigger = ScrollTrigger;
			window.ScrollToPlugin = ScrollToPlugin;
			
			// Batch ScrollTrigger refreshes to reduce reflows
			let refreshTimeout;
			const originalRefresh = ScrollTrigger.refresh;
			ScrollTrigger.refresh = function() {
				clearTimeout(refreshTimeout);
				refreshTimeout = setTimeout(() => {
					requestAnimationFrame(() => {
						originalRefresh.call(this);
					});
				}, 10);
			};
		}
		
		return Promise.resolve();
	}
	
	// Make loadGSAP available globally
	if (typeof window !== 'undefined') {
		window.loadGSAP = loadGSAP;
		
		// Auto-load GSAP on user interaction (scroll, click, touch) or after 2 seconds
		let interactionHandled = false;
		const loadOnInteraction = () => {
			if (!interactionHandled) {
				interactionHandled = true;
				loadGSAP();
			}
		};
		
		// Load on first user interaction
		['scroll', 'click', 'touchstart', 'mousemove'].forEach(event => {
			window.addEventListener(event, loadOnInteraction, { once: true, passive: true });
		});
		
		// Fallback: load after 2 seconds if no interaction
		setTimeout(() => {
			if (!interactionHandled) {
				loadGSAP();
			}
		}, 2000);
	}
</script>



